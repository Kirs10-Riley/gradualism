---
title: "GATT Analysis"
author: "Kristy Buzard"
date: "2/6/2021"
output: pdf_document
toc: yes
number_sections: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Importing and cleaning the data
Importing and cleaning the data is currently done with program "Cleaning the data in R .rmd" . It need to be reprogrammed before being added here because it is nearly 1000 lines long. The chunk below calls that program to make the processed data available to the rest of the commands in this document.

```{r data, message=FALSE, warning=FALSE, echo=TRUE}
source("C:/Users/krist/Github/Gradualism/data_cleaning.rmd", local = knitr::knit_global())
```


# Basic summary statistics

## Specific tariffs

We see below that the specific tariffs come down by roughly half from Smoot Hawley.

- About half came in Geneva, the rest through Dillon. That is, Geneva did half the work and the following four rounds did the other half

But this could be deceptive since different lines use different units

- Victor has standardized everything to be in cents (per U.S. dollar) -- add UnitsKey.rmd code here so that it is accessible when needed within the knitr session

```{r echo=FALSE, message=FALSE}
library(knitr)
library(qwraps2)
library(kableExtra)

sp_mean <- specific[,6:14] %>% sapply(mean, na.rm=TRUE)
sp_med <- specific[,6:14] %>% sapply(median, na.rm=TRUE)
sp_count <- specific[,6:14] %>% sapply(function(x) sum(!is.na(x)))
sp_min <- specific[,6:14] %>% sapply(min, na.rm=TRUE)
sp_max <- specific[,6:14] %>% sapply(max, na.rm=TRUE)
sp_25p <- specific[,6:14] %>% sapply(function(x) quantile(x,probs=0.25,na.rm = TRUE))
sp_75p <- specific[,6:14] %>% sapply(function(x) quantile(x,probs=0.75,na.rm = TRUE))

sp_table = cbind(data.frame(sp_min),data.frame(sp_25p),data.frame(sp_mean),data.frame(sp_med),data.frame(sp_75p),data.frame(sp_max),data.frame(sp_count))
names(sp_table)<-c('Min','1st Quartile','Mean','Median','3rd Quartile','Max','N')
rownames(sp_table) <- c("Smoot Hawley", "Geneva", "Annecy","Torquay","GenevaA","GenevaB","GenevaC","DillonA","DillonB")
s <- kbl(sp_table,digits=2,booktabs=T) %>% kable_styling(position = "center")
add_header_above(s, c(" " = 1,"Summary Statistics of Specific Tariffs by Round"=7),font_size = 12)
```

## Ad valorem tariffs

Strikingly, the reductions look to be of the same magnitude for Ad valorem, again with Geneva doing about half the work.


```{r echo=FALSE}
av_mean <- ad_valorem[,6:14] %>% sapply(mean, na.rm=TRUE)
av_med <- ad_valorem[,6:14] %>% sapply(median, na.rm=TRUE)
av_count <- ad_valorem[,6:14] %>% sapply(function(x) sum(!is.na(x)))
av_min <- ad_valorem[,6:14] %>% sapply(min, na.rm=TRUE)
av_max <- ad_valorem[,6:14] %>% sapply(max, na.rm=TRUE)
av_25p <- ad_valorem[,6:14] %>% sapply(function(x) quantile(x,probs=0.25,na.rm = TRUE))
av_75p <- ad_valorem[,6:14] %>% sapply(function(x) quantile(x,probs=0.75,na.rm = TRUE))

adval_table = cbind(data.frame(av_min),data.frame(av_25p),data.frame(av_mean),data.frame(av_med),data.frame(av_75p),data.frame(av_max),data.frame(av_count))
names(adval_table)<-c('Min','1st Quartile','Mean','Median','3rd Quartile','Max','N')
rownames(adval_table) <- c("Smoot Hawley", "Geneva", "Annecy","Torquay","GenevaA","GenevaB","GenevaC","DillonA","DillonB")
a <- kbl(adval_table,digits=2,booktabs=T) %>% kable_styling(position = "center")
add_header_above(a, c(" " = 1,"Summary Statistics of Ad Valorem Tariffs by Round"=7),font_size = 12)
```

- Roughly 2/3 of the lines have an ad valorem tariff. In Dillon, `r max(ad_valorem[,"Ad_Valorem_Dillon_B"])` rows out of `r nrow(ad_valorem)` are missing, so `r nrow(ad_valorem)` ad valorem tariffs. `r n_perc(ad_valorem$Ad_Valorem_Dillon_B == NA)` test2

# How did liberalization vary across Schedules?

## Summary stats for specific tariffs
```{r echo=FALSE, warning=FALSE}
#sum_specific <- specific %>%   
#  group_by(Sched) %>%  
#  summarize(SH_mean = mean(Specific_SH, na.rm=TRUE),
#            DB_mean = mean(Specific_Dillon_B, na.rm=TRUE),
#            SH_med = median(Specific_SH, na.rm=TRUE),
#            DB_med = median(Specific_Dillon_B, na.rm=TRUE),
#            SH_max = max(Specific_SH,na.rm=TRUE),
#            DB_max = max(Specific_Dillon_B,na.rm=TRUE),
#            SH_obs = sum(!is.na(Specific_SH)),
#            DB_obs = sum(!is.na(Specific_Dillon_B)),
#            n = n()) %>%
#  ungroup() # ungrouping variable is a good habit to prevent errors

#kbl(sum_specific,digits=2,booktabs=T) %>% kable_styling(position = "center")

#sum_specific_nI <- subset(specific, is.na(Interval)) %>%   
#  group_by(Sched) %>%  
#  summarize(SH_mean = mean(Specific_SH, na.rm=TRUE),
#            DB_mean = mean(Specific_Dillon_B, na.rm=TRUE),
#            SH_med = median(Specific_SH, na.rm=TRUE),
#            DB_med = median(Specific_Dillon_B, na.rm=TRUE),
#            SH_max = max(Specific_SH,na.rm=TRUE),
#            DB_max = max(Specific_Dillon_B,na.rm=TRUE),
#            SH_obs = sum(!is.na(Specific_SH)),
#            DB_obs = sum(!is.na(Specific_Dillon_B)),
#            n = n()) %>%
#  ungroup() # ungrouping variable is a good habit to prevent errors

#kbl(sum_specific_nI,digits=2,booktabs=T) %>% kable_styling(position = "center")

sum_specific_pc <- specific %>%   
  group_by(Sched) %>%  
  summarize(SH_mean = mean(Specific_SH, na.rm=TRUE),
            DB_mean = mean(Specific_Dillon_B, na.rm=TRUE),
            mean_chg = ((SH_mean - DB_mean)/SH_mean)*100,
            SH_med = median(Specific_SH, na.rm=TRUE),
            DB_med = median(Specific_Dillon_B, na.rm=TRUE),
            med_chg = ((SH_med - DB_med)/SH_med)*100,
            SH_obs = sum(!is.na(Specific_SH)),
            DB_obs = sum(!is.na(Specific_Dillon_B)),
            n = n()) %>%
  ungroup() # ungrouping variable is a good habit to prevent errors

kbl(sum_specific_pc,digits=2,booktabs=T) %>% kable_styling(position = "center")
```

The table below is exactly the same as the one above EXCEPT it drops the `r sum(!is.na(data_set$Interval))` lines that are impacted by the "tax interval" issue
```{r echo=FALSE, warning=FALSE}
sum_specific_nI_pc <- subset(specific, is.na(Interval)) %>%   
  group_by(Sched) %>%  
  summarize(SH_mean = mean(Specific_SH, na.rm=TRUE),
            DB_mean = mean(Specific_Dillon_B, na.rm=TRUE),
            mean_chg = ((SH_mean - DB_mean)/SH_mean)*100,
            SH_med = median(Specific_SH, na.rm=TRUE),
            DB_med = median(Specific_Dillon_B, na.rm=TRUE),
            med_chg = ((SH_med - DB_med)/SH_med)*100,
            SH_obs = sum(!is.na(Specific_SH)),
            DB_obs = sum(!is.na(Specific_Dillon_B)),
            n = n()) %>%
  ungroup() # ungrouping variable is a good habit to prevent errors

kbl(sum_specific_nI_pc,digits=2,booktabs=T) %>% kable_styling(position = "center")

```

Schedule 12 must be all ad valorem

## Summary stats for ad valorem tariffs
```{r echo=FALSE, warning=FALSE}
# sum_av <- ad_valorem %>%   
#   group_by(Sched) %>%  
#   summarize(SH_mean = mean(Ad_Valorem_SH, na.rm=TRUE),
#             DB_mean = mean(Ad_Valorem_Dillon_B, na.rm=TRUE),
#             SH_med = median(Ad_Valorem_SH, na.rm=TRUE),
#             DB_med = median(Ad_Valorem_Dillon_B, na.rm=TRUE),
#             SH_max = max(Ad_Valorem_SH,na.rm=TRUE),
#             DB_max = max(Ad_Valorem_Dillon_B,na.rm=TRUE),
#             SH_obs = sum(!is.na(Ad_Valorem_SH)),
#             DB_obs = sum(!is.na(Ad_Valorem_Dillon_B)),
#             n = n()) %>%
#   ungroup() # ungrouping variable is a good habit to prevent errors
# kbl(sum_av,digits=2,booktabs=T) %>% kable_styling(position = "center")

sum_av_pc <- ad_valorem %>%   
  group_by(Sched) %>%  
  summarize(SH_mean = mean(Ad_Valorem_SH, na.rm=TRUE),
            DB_mean = mean(Ad_Valorem_Dillon_B, na.rm=TRUE),
            mean_chg = ((SH_mean - DB_mean)/SH_mean)*100,
            SH_med = median(Ad_Valorem_SH, na.rm=TRUE),
            DB_med = median(Ad_Valorem_Dillon_B, na.rm=TRUE),
            med_chg = ((SH_med - DB_med)/SH_med)*100,
            SH_obs = sum(!is.na(Ad_Valorem_SH)),
            DB_obs = sum(!is.na(Ad_Valorem_Dillon_B)),
            n = n()) %>%
  ungroup() # ungrouping variable is a good habit to prevent errors
kbl(sum_av_pc,digits=2,booktabs=T) %>% kable_styling(position = "center")
```

For several paragraphs, the maximum tariff for Dillon B is ``lost'' when we get rid of the tax interval lines (2,9,11). Still I'm not going to print the tables with the maxes in them for now.
```{r}
sum_av_nI_pc <- subset(ad_valorem, is.na(Interval)) %>%   
  group_by(Sched) %>% 
  summarize(SH_mean = mean(Ad_Valorem_SH, na.rm=TRUE),
            DB_mean = mean(Ad_Valorem_Dillon_B, na.rm=TRUE),
            mean_chg = ((SH_mean - DB_mean)/SH_mean)*100,
            SH_med = median(Ad_Valorem_SH, na.rm=TRUE),
            DB_med = median(Ad_Valorem_Dillon_B, na.rm=TRUE),
            med_chg = ((SH_med - DB_med)/SH_med)*100,
            SH_obs = sum(!is.na(Ad_Valorem_SH)),
            DB_obs = sum(!is.na(Ad_Valorem_Dillon_B)),
            n = n()) %>%
  ungroup() # ungrouping variable is a good habit to prevent errors
kbl(sum_av_nI_pc,digits=2,booktabs=T) %>% kable_styling(position = "center")
```

# What was the total reduction in negotiated tariffs under the GATT in each round? 

Mean and median of specific tariffs in each round
```{r echo=FALSE, warning=FALSE, message=FALSE}

sp_mt = cbind(data.frame(sp_mean),c(0,-diff(sp_mean)/data.frame(sp_mean)[-nrow(data.frame(sp_mean)),]*100),data.frame(sp_med),c(0,-diff(sp_med)/data.frame(sp_med)[-nrow(data.frame(sp_med)),]*100))

names(sp_mt)<-c('Mean','% decrease','Median','% decrease')
rownames(sp_mt) <- c("Smoot Hawley", "Geneva", "Annecy","Torquay","GenevaA","GenevaB","GenevaC","DillonA","DillonB")
x <- kbl(sp_mt,digits=2,booktabs=T) %>% kable_styling(position = "center")
add_header_above(x, c(" " = 1,c("Decrease in specific tariffs by round"=4)),font_size = 12)


av_mt = cbind(data.frame(av_mean),c(0,-diff(av_mean)/data.frame(av_mean)[-nrow(data.frame(av_mean)),]*100),data.frame(av_med),c(0,-diff(av_med)/data.frame(av_med)[-nrow(data.frame(av_med)),]*100))

names(av_mt)<-c('Mean','% decrease','Median','% decrease')
rownames(av_mt) <- c("Smoot Hawley", "Geneva", "Annecy","Torquay","GenevaA","GenevaB","GenevaC","DillonA","DillonB")
y <- kbl(av_mt,digits=2,booktabs=T) %>% kable_styling(position = "center")
add_header_above(y, c(" " = 1,c("Decrease in ad valorem tariffs by round"=4)),font_size = 12)

```
# Which lines were only ad valorem, only specific, or both?

## Mixed

Next need to know about the lines that have both ad valorem and specific (or take them out from above); at least quantify them to start

```{r}
both <- data_set %>% mutate(bothSH=!is.na(data_set[,"Specific_SH"])&!is.na(data_set[,"Ad_Valorem_SH"]),bothGeneva=!is.na(data_set[,"Specific_Geneva"])&!is.na(data_set[,"Ad_Valorem_Geneva"]),bothAnnecy=!is.na(data_set[,"Specific_Annecy"])&!is.na(data_set[,"Ad_Valorem_Annecy"]),bothTorquay=!is.na(data_set[,"Specific_Torquay"])&!is.na(data_set[,"Ad_Valorem_Torquay"]),bothGeneva56A=!is.na(data_set[,"Specific_Geneva56_A"])&!is.na(data_set[,"Ad_Valorem_Geneva56_A"]),bothGeneva56B=!is.na(data_set[,"Specific_Geneva56_B"])&!is.na(data_set[,"Ad_Valorem_Geneva56_B"]),bothGeneva56C=!is.na(data_set[,"Specific_Geneva56_C"])&!is.na(data_set[,"Ad_Valorem_Geneva56_C"]),bothDillonA=!is.na(data_set[,"Specific_Dillon_A"])&!is.na(data_set[,"Ad_Valorem_Dillon_A"]),bothDillonB=!is.na(data_set[,"Specific_Dillon_B"])&!is.na(data_set[,"Ad_Valorem_Dillon_B"]))

sum(both$bothSH, na.rm = TRUE)
sum(both$bothGeneva, na.rm = TRUE)
sum(both$bothAnnecy, na.rm = TRUE)
sum(both$bothTorquay, na.rm = TRUE)
sum(both$bothGeneva56A, na.rm = TRUE)
sum(both$bothGeneva56B, na.rm = TRUE)
sum(both$bothGeneva56C, na.rm = TRUE)
sum(both$bothDillonA, na.rm = TRUE)
sum(both$bothDillonB, na.rm = TRUE)

```

### Victor's intuition on mixed lines
I believe many of the changes from specific tax to ad valorem or otherwise is because of the tax intervals. You could search the keywords “tax boundaries” and “tax interval(s)” in Extra column of every round to locate them.

### Proportions of specific, ad valorem, mixed

#### Smoot Hawley
`r nrow(data_set)` total lines minus 451 lines with both specific and ad valorem leaves `r 2956 - 451` that have at most one or the other. 1417 ad valorem only; 1013 specific only. This leave 75 with neither. Why?

```{r}
neither <- data_set %>% mutate(neitherSH=is.na(data_set[,"Specific_SH"])&is.na(data_set[,"Ad_Valorem_SH"]),neitherAnnecy=is.na(data_set[,"Specific_Annecy"])&is.na(data_set[,"Ad_Valorem_Annecy"]),neitherDillonB=is.na(data_set[,"Specific_Dillon_B"])&is.na(data_set[,"Ad_Valorem_Dillon_B"]))

print.data.frame(neither[which(neither$neitherSH==TRUE),c("Sched","Product","Paragraph","Description")],row.names = FALSE)

# print.data.frame(neither[which(neither$neitherAnnecy==TRUE),c("Sched","Product","Paragraph","Description")],row.names = FALSE)

print.data.frame(neither[which(neither$neitherDillonB==TRUE),c("Sched","Product","Paragraph","Description")],row.names = FALSE)
```

# How many lines see no change from Smoot Hawley to Dillon B?
The code below produces 391 lines that were the same
```{r echo=TRUE}
lines <- data_set %>%
        mutate(av_pc =((Ad_Valorem_SH - Ad_Valorem_Dillon_B)/Ad_Valorem_SH)*100,sp_pc
        =((Specific_SH - Specific_Dillon_B)/Specific_SH)*100)

lines2 <- subset(lines,is.na(sp_pc) | sp_pc==0) %>% subset(is.na(av_pc) | av_pc==0)
```

# Summarizing the impact of tax intervals

```{r}
# I think I could do this natively now without having to rely on Victor's excel spreadsheet
library(readxl)
intervals <- read_excel("C:/Users/krist/Downloads/tax_intervals_list (1).xlsx",range = "A1:M46")

intervals<-fill(intervals, Schedule, .direction="down")

intervals_total <- intervals[,c("Schedule","Paragraphs_affected","Lines_affected")] %>% group_by(Schedule) %>% summarise_all(sum) %>% ungroup()

```

# Implementation dates

Geneva 1: January 1, 1948 (Irwin 2017, p. 486)
