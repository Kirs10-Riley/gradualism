---
title: "GATT Analysis"
author: "Kristy Buzard"
date: "2/6/2021"
output:
  html_document:
    toc: yes
    number_sections: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Importing and cleaning the data
```{r, include=FALSE}
source("C:/Users/krist/Github/Gradualism/data_cleaning.rmd", local = knitr::knit_global())
```
Importing and cleaning the data is currently done with program "Cleaning the data in R .rmd" . It need to be reprogrammed before being added here because it is nearly 1000 lines long. For now, that means this program won't work by hitting the "Knit" button. We instead need the command rmarkdown::render("C:/Users/krist/Github/Gradualism/Gatt_analysis.rmd")


# Basic summary statistics

## Specific tariffs

We see below that the specific tariffs come down by roughly half from Smoot Hawley.

- About half came in Geneva, the rest through Dillon. That is, Geneva did half the work and the following four rounds did the other half

But this could be deceptive since different lines use different units

- Victor has standardized everything to be in cents (per U.S. dollar) -- add UnitsKey.rmd code here so that it is accessible when needed within the knitr session

```{r echo=FALSE}
specific_ss <- summary(specific[,])

library(knitr)
library(qwraps2)
kable(specific_ss)
```

## Ad valorem tariffs

Strikingly, the reductions look to be of the same magnitude for Ad valorem, again with Geneva doing about half the work.


```{r echo=FALSE}
adval_ss <- summary(ad_valorem[,])
kable(adval_ss)
```

- Roughly 2/3 of the lines have an ad valorem tariff. In Dillon, `r max(ad_valorem[,"Ad_Valorem_Dillon_B"])` rows out of `r nrow(ad_valorem)` are missing, so `r nrow(ad_valorem)` ad valorem tariffs. `r n_perc(ad_valorem$Ad_Valorem_Dillon_B == NA)` test2

# How did liberalization vary across Schedules?

Some summary stats for specific tariffs
```{r echo=FALSE, warning=FALSE}
sum_specific <- specific %>%   
  group_by(Sched) %>%  
  summarize(SH_mean = mean(Specific_SH, na.rm=TRUE),
            DB_mean = mean(Specific_Dillon_B, na.rm=TRUE),
            SH_median = median(Specific_SH, na.rm=TRUE),
            DB_median = median(Specific_Dillon_B, na.rm=TRUE),
            SH_max = max(Specific_SH,na.rm=TRUE),
            DB_max = max(Specific_Dillon_B,na.rm=TRUE),
            SH_nonmissing = sum(!is.na(Specific_SH)),
            DB_nonmissing = sum(!is.na(Specific_Dillon_B)),
            n_samples = n()) %>%
  ungroup() # ungrouping variable is a good habit to prevent errors
kable(sum_specific)
```

Schedule 12 must be all ad valorem

Some summary stats for ad valorem tariffs
```{r echo=FALSE, warning=FALSE}
sum_av <- ad_valorem %>%   
  group_by(Sched) %>%  
  summarize(SH_mean = mean(Ad_Valorem_SH, na.rm=TRUE),
            DB_mean = mean(Ad_Valorem_Dillon_B, na.rm=TRUE),
            SH_median = median(Ad_Valorem_SH, na.rm=TRUE),
            DB_median = median(Ad_Valorem_Dillon_B, na.rm=TRUE),
            SH_max = max(Ad_Valorem_SH,na.rm=TRUE),
            DB_max = max(Ad_Valorem_Dillon_B,na.rm=TRUE),
            SH_nonmissing = sum(!is.na(Ad_Valorem_SH)),
            DB_nonmissing = sum(!is.na(Ad_Valorem_Dillon_B)),
            n_samples = n()) %>%
  ungroup() # ungrouping variable is a good habit to prevent errors
kable(sum_av)
```

# What was the total reduction in negotiated tariffs under the GATT in each round? 

Mean and median of specific tariffs in each round
```{r echo=FALSE, warning=FALSE, message=FALSE}
library(kableExtra)
sp_mean_time <- specific %>%   
  summarize(Smoot_Hawley = mean(Specific_SH, na.rm=TRUE),
            Geneva = mean(Specific_Geneva, na.rm=TRUE),
            Annecy = mean(Specific_Annecy, na.rm=TRUE),
            Torquay = mean(Specific_Torquay, na.rm=TRUE),
            Geneva56A = mean(Specific_Geneva56_A, na.rm=TRUE),
            Geneva56B = mean(Specific_Geneva56_B, na.rm=TRUE),
            Geneva56C = mean(Specific_Geneva56_C, na.rm=TRUE),
            DillonA = mean(Specific_Dillon_A, na.rm=TRUE),
            DillonB = mean(Specific_Dillon_B, na.rm=TRUE)
            )
spmeant = data.frame(t(sp_mean_time))
spmeant = cbind(spmeant, c(0,-diff(spmeant$t.sp_mean_time.)/spmeant[-nrow(spmeant),] * 100))

sp_med_time <- specific %>%   
  summarize(SH_med = median(Specific_SH, na.rm=TRUE),
            G_med = median(Specific_Geneva, na.rm=TRUE),
            An_med = median(Specific_Annecy, na.rm=TRUE),
            Tor_med = median(Specific_Torquay, na.rm=TRUE),
            GA_med = median(Specific_Geneva56_A, na.rm=TRUE),
            GB_med = median(Specific_Geneva56_B, na.rm=TRUE),
            GC_med = median(Specific_Geneva56_C, na.rm=TRUE),
            DA_med = median(Specific_Dillon_A, na.rm=TRUE),
            DB_med = median(Specific_Dillon_B, na.rm=TRUE)
            )

spmt = data.frame(t(sp_med_time))
spmt = cbind(spmeant,spmt, c(0,-diff(spmt$t.sp_med_time.)/spmt[-nrow(spmt),] * 100))
names(spmt)<-c('Mean','% Decrease','Median','% Decrease')

x <- kable(spmt,digits=2, "html")  %>%
  kable_styling(full_width = F)
add_header_above(x, c("Mean and median of specific tariffs by round
"=5),font_size = "large")

av_mean_time <- ad_valorem %>%   
  summarize(Smoot_Hawley = mean(Ad_Valorem_SH, na.rm=TRUE),
            Geneva = mean(Ad_Valorem_Geneva, na.rm=TRUE),
            Annecy = mean(Ad_Valorem_Annecy, na.rm=TRUE),
            Torquay = mean(Ad_Valorem_Torquay, na.rm=TRUE),
            Geneva56A = mean(Ad_Valorem_Geneva56_A, na.rm=TRUE),
            Geneva56B = mean(Ad_Valorem_Geneva56_B, na.rm=TRUE),
            Geneva56C = mean(Ad_Valorem_Geneva56_C, na.rm=TRUE),
            DillonA = mean(Ad_Valorem_Dillon_A, na.rm=TRUE),
            DillonB = mean(Ad_Valorem_Dillon_B, na.rm=TRUE)
            )
avmeant = data.frame(t(av_mean_time))
avmeant = cbind(avmeant, c(0,-diff(avmeant$t.av_mean_time.)/avmeant[-nrow(avmeant),] * 100))

av_med_time <- ad_valorem %>%   
  summarize(SH_med = median(Ad_Valorem_SH, na.rm=TRUE),
            G_med = median(Ad_Valorem_Geneva, na.rm=TRUE),
            An_med = median(Ad_Valorem_Annecy, na.rm=TRUE),
            Tor_med = median(Ad_Valorem_Torquay, na.rm=TRUE),
            GA_med = median(Ad_Valorem_Geneva56_A, na.rm=TRUE),
            GB_med = median(Ad_Valorem_Geneva56_B, na.rm=TRUE),
            GC_med = median(Ad_Valorem_Geneva56_C, na.rm=TRUE),
            DA_med = median(Ad_Valorem_Dillon_A, na.rm=TRUE),
            DB_med = median(Ad_Valorem_Dillon_B, na.rm=TRUE)
            )

avmt = data.frame(t(av_med_time))
avmt = cbind(avmeant,avmt, c(0,-diff(avmt$t.av_med_time.)/avmt[-nrow(avmt),] * 100))
names(avmt)<-c('Mean','% Decrease','Median','% Decrease')

y <- kable(avmt,digits=2, "html")  %>%
  kable_styling(full_width = F)
add_header_above(y, c("Mean and median of ad valorem tariffs by round
"=5),font_size = "large")
```
# Which lines were only ad valorem, only specific, or both?

## Mixed

Next need to know about the lines that have both ad valorem and specific (or take them out from above); at least quantify them to start

```{r}
both <- data_set %>% mutate(bothSH=!is.na(data_set[,"Specific_SH"])&!is.na(data_set[,"Ad_Valorem_SH"]),bothGeneva=!is.na(data_set[,"Specific_Geneva"])&!is.na(data_set[,"Ad_Valorem_Geneva"]),bothAnnecy=!is.na(data_set[,"Specific_Annecy"])&!is.na(data_set[,"Ad_Valorem_Annecy"]),bothTorquay=!is.na(data_set[,"Specific_Torquay"])&!is.na(data_set[,"Ad_Valorem_Torquay"]),bothGeneva56A=!is.na(data_set[,"Specific_Geneva56_A"])&!is.na(data_set[,"Ad_Valorem_Geneva56_A"]),bothGeneva56B=!is.na(data_set[,"Specific_Geneva56_B"])&!is.na(data_set[,"Ad_Valorem_Geneva56_B"]),bothGeneva56C=!is.na(data_set[,"Specific_Geneva56_C"])&!is.na(data_set[,"Ad_Valorem_Geneva56_C"]),bothDillonA=!is.na(data_set[,"Specific_Dillon_A"])&!is.na(data_set[,"Ad_Valorem_Dillon_A"]),bothDillonB=!is.na(data_set[,"Specific_Dillon_B"])&!is.na(data_set[,"Ad_Valorem_Dillon_B"]))

sum(both$bothSH, na.rm = TRUE)
sum(both$bothGeneva, na.rm = TRUE)
sum(both$bothAnnecy, na.rm = TRUE)
sum(both$bothTorquay, na.rm = TRUE)
sum(both$bothGeneva56A, na.rm = TRUE)
sum(both$bothGeneva56B, na.rm = TRUE)
sum(both$bothGeneva56C, na.rm = TRUE)
sum(both$bothDillonA, na.rm = TRUE)
sum(both$bothDillonB, na.rm = TRUE)

```

### Victor's intuition on mixed lines
I believe many of the changes from specific tax to ad valorem or otherwise is because of the tax intervals. You could search the keywords “tax boundaries” and “tax interval(s)” in Extra column of every round to locate them.

### Proportions of specific, ad valorem, mixed

#### Smoot Hawley
2956 total lines minus 451 lines with both specific and ad valorem leaves `r 2956 - 451` that have at most one or the other. 1417 ad valorem only; 1013 specific only. This leave 75 with neither. Why?

```{r}
neither <- data_set %>% mutate(neitherSH=is.na(data_set[,"Specific_SH"])&is.na(data_set[,"Ad_Valorem_SH"]),neitherAnnecy=is.na(data_set[,"Specific_Annecy"])&is.na(data_set[,"Ad_Valorem_Annecy"]),neitherDillonB=is.na(data_set[,"Specific_Dillon_B"])&is.na(data_set[,"Ad_Valorem_Dillon_B"]))

print.data.frame(neither[which(neither$neitherSH==TRUE),c("Sched","Product","Paragraph","Description")],row.names = FALSE)

# print.data.frame(neither[which(neither$neitherAnnecy==TRUE),c("Sched","Product","Paragraph","Description")],row.names = FALSE)

print.data.frame(neither[which(neither$neitherDillonB==TRUE),c("Sched","Product","Paragraph","Description")],row.names = FALSE)
```

# Implementation dates

Geneva 1: January 1, 1948 (Irwin 2017, p. 486)
